<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>7TV Live Emote Tracker</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: #0a0013;
      color: #fff;
      text-align: center;
      min-height: 100vh;
      background-image: url("peepo.png");
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-repeat: no-repeat;
      overflow-x: hidden;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top left, rgba(90, 0, 255, 0.4), transparent),
                  radial-gradient(circle at bottom right, rgba(180, 0, 255, 0.25), transparent),
                  rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(12px);
      z-index: -1;
    }

    h1 {
      margin-top: 1.2rem;
      font-size: 2rem;
      color: #c8a9ff;
      text-shadow: 0 0 10px #a76eff, 0 0 25px #6b2cff;
      animation: glowPulse 2s infinite alternate;
    }

    @keyframes glowPulse {
      from { text-shadow: 0 0 8px #9b59ff, 0 0 16px #823bff; }
      to { text-shadow: 0 0 18px #bb8cff, 0 0 32px #b57bff; }
    }

    input, button {
      padding: 0.6rem 1rem;
      border: 2px solid #9146FF;
      border-radius: 10px;
      background: #161024;
      color: white;
      margin: 0.5rem;
      font-size: 1rem;
      transition: 0.3s;
      box-shadow: 0 0 10px rgba(145, 70, 255, 0.3);
    }

    input:focus {
      border-color: #b68cff;
      outline: none;
      box-shadow: 0 0 12px #b68cff;
    }

    button {
      background: linear-gradient(90deg, #9146FF, #b88cff);
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 0 12px #9146ff7a;
    }

    button:hover {
      box-shadow: 0 0 18px #b88cff;
      transform: scale(1.03);
    }

    #title {
      margin-top: 0.8rem;
      font-size: 1.2rem;
      color: #c7b6ff;
      text-shadow: 0 0 8px #8f6cff;
    }

    #tables {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      margin-top: 2rem;
    }

    .table-container {
      width: 45%;
      min-width: 320px;
      background: rgba(10, 0, 25, 0.6);
      border: 2px solid rgba(130, 60, 255, 0.4);
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(145, 70, 255, 0.15);
      padding: 1rem;
      transition: 0.3s;
    }

    .table-container:hover {
      box-shadow: 0 0 30px rgba(160, 90, 255, 0.3);
    }

    h2 {
      color: #d2b6ff;
      text-shadow: 0 0 8px #a66eff;
      font-weight: 600;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      background: rgba(25, 10, 40, 0.6);
      border-radius: 10px;
      overflow: hidden;
    }

    th, td {
      padding: 10px 16px;
      border-bottom: 1px solid rgba(90, 50, 160, 0.3);
    }

    th {
      background: rgba(90, 40, 160, 0.3);
      color: #c6a3ff;
      text-transform: uppercase;
      font-size: 0.85rem;
      letter-spacing: 1px;
    }

    td {
      color: #fff;
      font-size: 1rem;
    }

    tr:nth-child(even) {
      background: rgba(50, 30, 90, 0.4);
    }

    tr:hover {
      background: rgba(100, 50, 200, 0.4);
      transition: 0.2s;
    }
  </style>
</head>
<body>
  <h1>üí´ 7TV Live Tracker</h1>

  <div>
    <input id="channelInput" placeholder="Enter Twitch channel..." />
    <button onclick="loadChannel()">Track Channel</button>
  </div>
  <div id="title"></div>

  <div id="tables">
    <div class="table-container">
      <h2>üßç User Leaderboard</h2>
      <table>
        <thead><tr><th>#</th><th>User</th><th>Count</th></tr></thead>
        <tbody id="userboard"></tbody>
      </table>
    </div>

    <div class="table-container">
      <h2>üé≠ Emote Leaderboard</h2>
      <table>
        <thead><tr><th>#</th><th>Emote</th><th>Count</th></tr></thead>
        <tbody id="emoteboard"></tbody>
      </table>
    </div>
  </div>

  <script>
    const ws = new WebSocket(`ws://${location.host}`);
    let channel = null;
    let users = {};
    let emoteUsage = {};

    ws.onmessage = (e) => {
      const data = JSON.parse(e.data);
      if (data.channel === channel && data.type === "update") {
        users[data.user.id] = data.user;
        emoteUsage = data.emoteUsage;
        render();
      }
    };

    async function loadChannel() {
      channel = document.getElementById("channelInput").value.trim().toLowerCase();
      if (!channel) return;
      const res = await fetch(`/api/channel/${channel}`);
      const data = await res.json();
      users = {};
      data.users.forEach((u) => (users[u.id] = u));
      emoteUsage = data.emoteUsage;
      document.getElementById("title").innerText = `Tracking: ${channel}`;
      render();
    }

    function render() {
      const sortedUsers = Object.values(users).sort((a, b) => b.count - a.count);
      const sortedEmotes = Object.entries(emoteUsage)
        .sort((a, b) => b[1] - a[1])
        .map(([name, count]) => ({ name, count }));

      document.getElementById("userboard").innerHTML = sortedUsers
        .map((u, i) => `<tr><td>${i + 1}</td><td>${u.username}</td><td>${u.count}</td></tr>`)
        .join("");

      document.getElementById("emoteboard").innerHTML = sortedEmotes
        .map((e, i) => `<tr><td>${i + 1}</td><td>${e.name}</td><td>${e.count}</td></tr>`)
        .join("");
    }
  </script>
</body>
</html>
